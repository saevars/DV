<meta charset="utf-8">
<style>

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: .5px;
  stroke-opacity: .5;
}

.land {
  fill: #222;
}

.boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

</style>
<body>
<script src="D3/d3.min.js"></script>
<script src="D3/topojson.v1.min.js"></script>
<script src="gps10.js"></script>
<script src="gps20.js"></script>
<script src="gps.js"></script>
<script src="Iceland.js"></script>

<script>


var zoomListener = d3.behavior.zoom()
  .scaleExtent([1, 50])
  .on("zoom", zoomHandler);

// function for handling zoom event
function zoomHandler() {
  svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}


var width = 1600,
    height = 900;
var projection = d3.geo.equirectangular()
    .scale(240)
    .translate([width / 2, height / 2])
    .precision(.1);

var path = d3.geo.path()
    .projection(projection);

var graticule = d3.geo.graticule();


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
        .attr("x", 0)
        .attr("y",0)
 svg.append("rect").attr("width",width).attr("height",height);



svg.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);

d3.json("world-50m.json", function(error, world) {
  svg.insert("path", ".graticule")
     .datum(topojson.feature(world, world.objects.land))
      .attr("class", "land")
      .attr("d", path);

  svg.insert("path", ".graticule")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "boundary")
      .attr("d", path);
});

d3.select(self.frameElement).style("height", height + "px");

// -------------------------------------------------------------------------------------
// And now it is time for some for some magic ! ----------------------------------------
// -------------------------------------------------------------------------------------


 
//Map out all the gps points as red circles ------------------------------------------------------


    zoomListener(svg);

function NewData(dataSet, gpsCoords){
    var links  = {paths :[], dist : []};

    for(var i=0, len=dataSet.length; i<len; i++){
        // (note: loop until length - 1 since we're getting the next
        //  item with i+1)
        console.log(dataSet[i].Cor1, dataSet[i].Cor2)
        links.dist.push(dataSet[i].Dist)
        links.paths.push({
            type: "LineString",
            coordinates: [
                [dataSet[i].Cor1.x, dataSet[i].Cor1.y], [dataSet[i].Cor2.x, dataSet[i].Cor2.y]
            ]
        });
    }


     maximal =  d3.max(dataSet, function(d){
         return d.Dist;
     });

     colorScale=d3.scale.pow().domain([0,maximal]).range(["blue","red"]);

     lineWidthScale=d3.scale.pow().domain([0,maximal]).rangeRound([1,2]);
   
   svg.selectAll("circles.points")
    .data(gpsCoords)
    .enter()
    .append("circle")
    .attr("r", 1)
    .attr("transform", function(d) {return "translate(" + projection([d.x,d.y]) + ")";})
    .attr("opacity", 1)
    .style({
            fill : "red",
            'vector-effect' : "non-scaling-stroke"
        });


  // Enter the great archs of the world ! --------------------------------------------------------


   svg.selectAll(".arc")
    .data(links.paths)
    .enter()
    .append("path")
    .attr({'class': 'arc'})
    .style({ 
            fill: 'none',
            'stroke-width': function(d,i){return lineWidthScale(links.dist[i]);},
            'stroke-opacity': 0.5,
            'vector-effect' : "non-scaling-stroke",
            'stroke'      : function(d,i){return colorScale(+links.dist[i]);}
          })
    .attr({d: path});

  }

  //Clear shit of the map ! ----------------------------------------------------------------------

  function ClearData(){
    svg.selectAll("circle").data([]).exit().remove();
    svg.selectAll(".arc").data([]).exit().remove();
  }

  function Data1(){
    ClearData();

   // RunStuff(dataSetI, gpsCoordsI);
    NewData(dataSetI, gpsCoordsI);
  }

  function Data2(){
    ClearData();

 
    NewData(dataSet20, gpsCoords20);
  }

  function Data3(){
    ClearData();

    NewData(dataSetB, gpsCoordsB);
  }


</script>
<body>t 
    <p>
        <input type="button" value="Data1" onclick="Data1();">
        <input type="button" value="Data2" onclick="Data2();">
        <input type="button" value="Data3" onclick="Data3();">
        <input type="button" value="Clear" onclick="ClearData();">
    </p>
</body>
